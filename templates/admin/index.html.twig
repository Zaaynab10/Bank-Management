{% extends 'base.html.twig' %}

{% block title %}Admin Dashboard
{% endblock %}

{% block body %}
	<div
		class="admin-dashboard">
		<!-- Sidebar -->
		<aside class="sidebar">
			<video autoplay muted loop class="background-video">
				<source src="{{ asset('videos/light-side.mp4') }}" type="video/mp4"/>
			</video>
			<div class="search-bar">
				<input type="text" id="searchInput" placeholder="Rechercher un utilisateur..."/>
			</div>
			<div
				id="userResults" class="user-results"><!-- Les résultats de la recherche seront insérés ici -->
			</div>
		</aside>

		<!-- Main Content -->
		<main
			class="main-content">
			<!-- Header -->
			<header class="dashboard-header">
				<div class="logo">
					<a href="#">
						<img class="bank-logo" src="{{ asset('images/logo-clair.png') }}" alt="Bank Logo">
					</a>
				</div>
				<div class="welcome-section">
					<h1>Welcome,
						{{ user.firstName }}
						{{ user.lastName }}</h1>
				</div>
				<div
					class="admin-info">
					<!-- Admin photo -->
					<img
					src="{{ asset('images/cat-profile.jpg') }}" alt="Admin Profile Picture" class="admin-photo" id="adminToggle">

					<!-- Hidden Navigation -->
					<div class="hidden-nav">
						<ul>
							<li class="nav-item">
								<a href="{{ path('app_logout') }}">
									<img src="{{ asset('images/sign-out.svg') }}" alt="Sign Out" class="nav-icon">
								</a>
							</li>
							<li class="nav-item">
								<button class="stats-icon" data-target="add-user">
									<img src="{{ asset('images/add-user.svg') }}" alt="Add client or admin" class="nav-icon"></button>
							</li>
							<li class="nav-item">
								<div class="dark-mode-switch">
									<img id="themeIcon" src="/images/sun.svg" alt="Theme Icon">
								</div>
							</li>
						</ul>
					</li>
				</div>
			</div>
		</header>

		<!-- Stats Section -->
		<section
			class="stats-section">
			<!-- Navigation Icons -->
			<nav class="stats-nav">
				<button class="stats-icon" data-target="clients-details">
					<img src="{{ asset('images/clients.svg') }}" alt="Clients Icon">
				</button>
				<button class="stats-icon" data-target="transactions-details">
					<img src="{{ asset('images/transactions.svg') }}" alt="Transactions Icon">
				</button>
				<button class="stats-icon" data-target="stats-details">
					<img src="{{ asset('images/stats.svg') }}" alt="Other Icon">
				</button>
			</nav>

			<!-- Details Containers -->
			<section class="details-container">
				<div id="clients-details" class="details-content">
					<h2>Clients Details</h2>
					<p>Nombre de clients :
						{{ totalClients }}</p>
				</div>

				<div id="transactions-details" class="details-content">
					<h2>Transactions</h2>
					{% if transactions is defined and transactions|length > 0 %}
						<table>
							<thead>
								<tr>
									<th>Montant</th>
									<th>Date</th>
									<th>Type</th>
									<th>Statut</th>
									<th>Actions</th>
								</tr>
							</thead>
							<tbody>
								{% for transaction in transactions %}
									<tr>
										<td>{{ transaction.amount }}
											€</td>
										<td>{{ transaction.date_time|date('d/m/Y H:i') }}</td>
										<td>{{ transaction.type }}</td>
										<td>{{ transaction.status }}</td>
										<td>
											<form method="post" action="{{ path('admin_transaction_cancel', { id: transaction.id }) }}">
												<button type="submit" class="btn-cancel">Annuler</button>
											</form>
										</td>
									</tr>
								{% endfor %}
							</tbody>
						</table>
					{% else %}
						<p>Aucune transaction trouvée.</p>
					{% endif %}
				</div>

				<div id="stats-details" class="details-content">
					<h2>Stats des Comptes</h2>
					<p>Nombre de Comptes :
						{{ totalAccounts }}</p>
				</div>

				<div id="add-user" class="details-content">
					<h2>Ajouter un utilisateur</h2>
					<form method="post" action="{{ path('admin_add_user') }}" class="add-user-form">
						<div>
							<label for="firstName">Prénom</label>
							<input type="text" id="firstName" name="firstName" required>
						</div>
						<div>
							<label for="lastName">Nom</label>
							<input type="text" id="lastName" name="lastName" required>
						</div>
						<div>
							<label for="email">Email</label>
							<input type="email" id="email" name="email" required>
						</div>
						<div>
							<label for="phone">Téléphone</label>
							<input type="text" id="phone" name="phone">
						</div>
						<div>
							<label for="password">Mot de passe</label>
							<input type="password" id="password" name="password" required>
						</div>
						<div>
							<label for="roles">Rôle</label>
							<select id="roles" name="roles" required>
								<option value="ROLE_ADMIN">Admin</option>
								<option value="ROLE_CUSTOMER">Client</option>
							</select>
						</div>
						<button type="submit" class="btn-submit">Ajouter</button>
					</form>
				</div>

			</section>
		</section>
	</main>
</div>{% endblock %}
